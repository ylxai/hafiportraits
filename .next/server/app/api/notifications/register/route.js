"use strict";(()=>{var e={};e.id=393,e.ids=[393],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3614:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>D,originalPathname:()=>y,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>h});var s={};t.r(s),t.d(s,{DELETE:()=>d,POST:()=>c,PUT:()=>u});var o=t(5419),i=t(9108),n=t(9678),a=t(8070);async function c(e){try{let{token:r,userAgent:t,timestamp:s,type:o="web"}=await e.json();if(!r)return a.Z.json({success:!1,error:"FCM token is required"},{status:400});let i={id:`device_${r.substring(0,16)}_${Date.now()}`,token:r,userAgent:t,type:o,registeredAt:s||new Date().toISOString(),isActive:!0,lastSeen:new Date().toISOString(),topics:["general"],preferences:{uploadSuccess:!0,uploadFailed:!0,cameraDisconnected:!0,storageWarning:!0,eventMilestone:!0,quietHours:{enabled:!1,start:"22:00",end:"08:00"}}};return console.log("\uD83D\uDCF1 Device registered:",i),await l(r),a.Z.json({success:!0,data:{deviceId:i.id,topics:i.topics,message:"Device registered successfully"}})}catch(e){return console.error("❌ Error registering device:",e),a.Z.json({success:!1,error:"Failed to register device"},{status:500})}}async function u(e){try{let{token:r,preferences:t,topics:s}=await e.json();if(!r)return a.Z.json({success:!1,error:"FCM token is required"},{status:400});return console.log("\uD83D\uDD04 Device updated:",{token:r,preferences:t,topics:s}),a.Z.json({success:!0,data:{message:"Device updated successfully"}})}catch(e){return console.error("❌ Error updating device:",e),a.Z.json({success:!1,error:"Failed to update device"},{status:500})}}async function d(e){try{let{searchParams:r}=new URL(e.url),t=r.get("token");if(!t)return a.Z.json({success:!1,error:"FCM token is required"},{status:400});return console.log("\uD83D\uDDD1️ Device unregistered:",t),a.Z.json({success:!0,data:{message:"Device unregistered successfully"}})}catch(e){return console.error("❌ Error unregistering device:",e),a.Z.json({success:!1,error:"Failed to unregister device"},{status:500})}}async function l(e){try{for(let r of["general","uploads","system"])console.log(`📢 Subscribing ${e.substring(0,16)}... to topic: ${r}`)}catch(e){console.error("❌ Error subscribing to default topics:",e)}}let g=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/notifications/register/route",pathname:"/api/notifications/register",filename:"route",bundlePath:"app/api/notifications/register/route"},resolvedPagePath:"/home/devbox/hafi-portrait-stable/src/app/api/notifications/register/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:v,serverHooks:f,headerHooks:D,staticGenerationBailout:h}=g,y="/api/notifications/register/route";function m(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:v})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,206],()=>t(3614));module.exports=s})();